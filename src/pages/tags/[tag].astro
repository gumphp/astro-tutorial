---
import BaseLayouts from "../../layouts/BaseLayouts.astro"
import BlogPost from "../../components/BlogPost.astro"

export async function getStaticPaths() {
    const allPosts = Object.values(import.meta.glob('../posts/*.md', { eager: true }));

    return [
        {
            params: {
                tag: "astro"
            },
            props: {posts: allPosts}
        },
        {
            params: {
                tag: "success"
            },
            props: {posts: allPosts}
        },
        {
            params: {
                tag: "community"
            },
            props: {posts: allPosts}
        },
        {
            params: {
                tag: "blogging"
            },
            props: {posts: allPosts}
        },
        {
            params: {
                tag: "setbacks"
            },
            props: {posts: allPosts}
        },
        {
            params: {
                tag: "learning in public"
            },
            props: {posts: allPosts}
        }
    ];
}

const { tag } = Astro.params
const { posts } = Astro.props
const filteredPosts = posts.filter((post: any) => post.frontmatter.tags?.includes(tag));
---

<BaseLayouts pageTitle={`标签：${tag}`}>
    <p>这是一个关于标签 <strong>{tag}</strong> 的页面。</p>
    <ul>
        {filteredPosts.map((post: any) => <BlogPost url={post.url} title={post.frontmatter.title}/>)}
    </ul>
    
    <p>总共有 {filteredPosts.length} 篇文章使用了这个标签。</p>
</BaseLayouts>